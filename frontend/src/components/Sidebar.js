import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { NavLink, useLocation } from 'react-router-dom';
import { useUIStore } from '../stores/useUIStore';
import { LayoutDashboard, Users, Wallet, UserCog, Settings, Building2, Home, ArrowDownUp, LogIn, LogOut, GraduationCap, CreditCard, Receipt, BookOpen, FileText, AlertCircle, ListChecks, DollarSign, Calendar } from 'lucide-react';
import { motion, AnimatePresence } from 'framer-motion';
import { useAuthStore } from '../stores/useAuthStore';
import { useState } from 'react';
const bottomMenu = [
    // Pengguna is admin-only; we'll conditionally render it below
    { to: '/pengaturan', label: 'Pengaturan', icon: Settings },
];
export default function Sidebar() {
    const { sidebarOpen, toggleSidebar } = useUIStore();
    const [kesantrianOpen, setKesantrianOpen] = useState(true);
    const [kesantrianMutasiOpen, setKesantrianMutasiOpen] = useState(false);
    const [keuanganOpen, setKeuanganOpen] = useState(true);
    const [keuanganTunggakanOpen, setKeuanganTunggakanOpen] = useState(false);
    const [keuanganPengaturanOpen, setKeuanganPengaturanOpen] = useState(false);
    const [akademikOpen, setAkademikOpen] = useState(true);
    const [dompetOpen, setDompetOpen] = useState(false);
    const location = useLocation();
    const currentUser = useAuthStore((s) => s.user);
    const roles = useAuthStore((s) => s.roles);
    const currentRole = roles?.find((r) => r.slug === currentUser?.role);
    const hasAccess = (key) => {
        // Admin always has access
        if (!currentUser)
            return false;
        if (currentUser.role === 'admin')
            return true;
        if (!currentRole)
            return false;
        // if menus is null => full access
        if (currentRole.menus === null)
            return true;
        if (!Array.isArray(currentRole.menus))
            return false;
        return currentRole.menus.includes(key);
    };
    const dompetActive = location.pathname.startsWith('/dompet');
    const kesantrianActive = location.pathname.startsWith('/kesantrian');
    const keuanganActive = location.pathname.startsWith('/keuangan');
    const akademikActive = location.pathname.startsWith('/akademik');
    // Handler untuk menampilkan sidebar saat ada sentuhan di area sidebar saat collapsed
    const handleSidebarHover = () => {
        if (!sidebarOpen) {
            toggleSidebar();
        }
    };
    return (_jsxs(motion.aside, { initial: { width: 260 }, animate: { width: sidebarOpen ? 260 : 72 }, transition: { type: 'spring', stiffness: 200, damping: 25 }, onMouseEnter: handleSidebarHover, className: "h-screen border-r border-gray-200 bg-[#F5F5F5] flex flex-col relative", children: [_jsx("div", { className: "px-4 py-4", children: _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("div", { className: "w-8 h-8 rounded bg-brand" }), sidebarOpen && _jsx("span", { className: "font-semibold", children: "SIMPELS v2" })] }) }), _jsx("nav", { className: "px-2 space-y-1 flex flex-col h-[calc(100vh-64px)]", children: _jsxs("div", { className: "flex-1 space-y-1 overflow-y-auto", children: [hasAccess('dashboard') && (_jsxs(NavLink, { to: "/", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(LayoutDashboard, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Dashboard" })] })), _jsxs("div", { className: "space-y-1", children: [_jsxs("button", { type: "button", onClick: () => setKesantrianOpen((v) => !v), className: `w-full flex items-center gap-3 rounded-md px-3 py-2 text-sm ${kesantrianActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Users, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Kesantrian" })] }), _jsx(AnimatePresence, { initial: false, children: kesantrianOpen && sidebarOpen && (_jsx(motion.div, { initial: { height: 0, opacity: 0 }, animate: { height: 'auto', opacity: 1 }, exit: { height: 0, opacity: 0 }, transition: { type: 'tween', duration: 0.2 }, className: "overflow-hidden", children: _jsxs("ul", { className: "ml-5 space-y-1 border-l border-gray-300 pl-3", children: [_jsx("li", { children: hasAccess('kesantrian.santri') && (_jsxs(NavLink, { to: "/kesantrian/santri", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Users, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Data Santri" })] })) }), _jsx("li", { children: hasAccess('kesantrian.kelas') && (_jsxs(NavLink, { to: "/kesantrian/kelas", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Building2, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Kelas" })] })) }), _jsx("li", { children: hasAccess('kesantrian.asrama') && (_jsxs(NavLink, { to: "/kesantrian/asrama", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Home, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Asrama" })] })) }), _jsxs("li", { children: [_jsxs("button", { type: "button", onClick: () => setKesantrianMutasiOpen((v) => !v), className: `w-full flex items-center gap-3 rounded-md px-3 py-2 text-sm ${location.pathname.startsWith('/kesantrian/mutasi') ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(ArrowDownUp, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Mutasi" })] }), _jsx(AnimatePresence, { initial: false, children: kesantrianMutasiOpen && sidebarOpen && (_jsx(motion.div, { initial: { height: 0, opacity: 0 }, animate: { height: 'auto', opacity: 1 }, exit: { height: 0, opacity: 0 }, transition: { type: 'tween', duration: 0.2 }, className: "overflow-hidden", children: _jsxs("ul", { className: "ml-5 space-y-1 border-l border-gray-300 pl-3", children: [_jsx("li", { children: hasAccess('kesantrian.mutasi.masuk') && (_jsxs(NavLink, { to: "/kesantrian/mutasi/masuk", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(LogIn, { className: "w-4 h-4" }), sidebarOpen && _jsx("span", { children: "Masuk" })] })) }), _jsx("li", { children: hasAccess('kesantrian.mutasi.keluar') && (_jsxs(NavLink, { to: "/kesantrian/mutasi/keluar", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(LogOut, { className: "w-4 h-4" }), sidebarOpen && _jsx("span", { children: "Keluar" })] })) })] }) })) })] }), _jsx("li", { children: hasAccess('kesantrian.alumni') && (_jsxs(NavLink, { to: "/kesantrian/alumni", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(GraduationCap, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Alumni" })] })) })] }) })) })] }), _jsxs("div", { className: "space-y-1", children: [_jsxs("button", { type: "button", onClick: () => setKeuanganOpen((v) => !v), className: `w-full flex items-center gap-3 rounded-md px-3 py-2 text-sm ${keuanganActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Wallet, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Keuangan" })] }), _jsx(AnimatePresence, { initial: false, children: keuanganOpen && sidebarOpen && (_jsx(motion.div, { initial: { height: 0, opacity: 0 }, animate: { height: 'auto', opacity: 1 }, exit: { height: 0, opacity: 0 }, transition: { type: 'tween', duration: 0.2 }, className: "overflow-hidden", children: _jsxs("ul", { className: "ml-5 space-y-1 border-l border-gray-300 pl-3", children: [_jsx("li", { children: hasAccess('keuangan.pembayaran') && (_jsxs(NavLink, { to: "/keuangan/pembayaran", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(CreditCard, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Pembayaran Santri" })] })) }), _jsx("li", { children: hasAccess('keuangan.transaksi-kas') && (_jsxs(NavLink, { to: "/keuangan/transaksi-kas", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Receipt, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Transaksi Kas" })] })) }), _jsx("li", { children: hasAccess('keuangan.buku-kas') && (_jsxs(NavLink, { to: "/keuangan/buku-kas", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(BookOpen, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Buku Kas" })] })) }), _jsx("li", { children: hasAccess('keuangan.tagihan') && (_jsxs(NavLink, { to: "/keuangan/tagihan", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(FileText, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Tagihan Santri" })] })) }), _jsxs("li", { children: [_jsxs("button", { type: "button", onClick: () => setKeuanganTunggakanOpen((v) => !v), className: `w-full flex items-center gap-3 rounded-md px-3 py-2 text-sm ${location.pathname.startsWith('/keuangan/tunggakan') ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(AlertCircle, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Tunggakan Santri" })] }), _jsx(AnimatePresence, { initial: false, children: keuanganTunggakanOpen && sidebarOpen && (_jsx(motion.div, { initial: { height: 0, opacity: 0 }, animate: { height: 'auto', opacity: 1 }, exit: { height: 0, opacity: 0 }, transition: { type: 'tween', duration: 0.2 }, className: "overflow-hidden", children: _jsxs("ul", { className: "ml-5 space-y-1 border-l border-gray-300 pl-3", children: [_jsx("li", { children: _jsxs(NavLink, { to: "/keuangan/tunggakan/aktif", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Users, { className: "w-4 h-4" }), sidebarOpen && _jsx("span", { children: "Aktif" })] }) }), _jsx("li", { children: _jsxs(NavLink, { to: "/keuangan/tunggakan/mutasi", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(ArrowDownUp, { className: "w-4 h-4" }), sidebarOpen && _jsx("span", { children: "Mutasi" })] }) }), _jsx("li", { children: _jsxs(NavLink, { to: "/keuangan/tunggakan/alumni", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(GraduationCap, { className: "w-4 h-4" }), sidebarOpen && _jsx("span", { children: "Alumni" })] }) })] }) })) })] }), _jsxs("li", { children: [_jsxs("button", { type: "button", onClick: () => setKeuanganPengaturanOpen((v) => !v), className: `w-full flex items-center gap-3 rounded-md px-3 py-2 text-sm ${location.pathname.startsWith('/keuangan/pengaturan') ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Settings, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Pengaturan" })] }), _jsx(AnimatePresence, { initial: false, children: keuanganPengaturanOpen && sidebarOpen && (_jsx(motion.div, { initial: { height: 0, opacity: 0 }, animate: { height: 'auto', opacity: 1 }, exit: { height: 0, opacity: 0 }, transition: { type: 'tween', duration: 0.2 }, className: "overflow-hidden", children: _jsxs("ul", { className: "ml-5 space-y-1 border-l border-gray-300 pl-3", children: [_jsx("li", { children: _jsxs(NavLink, { to: "/keuangan/pengaturan/jenis-tagihan", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(ListChecks, { className: "w-4 h-4" }), sidebarOpen && _jsx("span", { children: "Jenis Tagihan" })] }) }), _jsx("li", { children: _jsxs(NavLink, { to: "/keuangan/pengaturan/keringanan", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(DollarSign, { className: "w-4 h-4" }), sidebarOpen && _jsx("span", { children: "Keringanan Tagihan" })] }) })] }) })) })] })] }) })) })] }), _jsxs("div", { className: "space-y-1", children: [_jsxs("button", { type: "button", onClick: () => setDompetOpen((v) => !v), className: `w-full flex items-center gap-3 rounded-md px-3 py-2 text-sm ${dompetActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(DollarSign, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Dompet Digital" })] }), _jsx(AnimatePresence, { initial: false, children: dompetOpen && sidebarOpen && (_jsx(motion.div, { initial: { height: 0, opacity: 0 }, animate: { height: 'auto', opacity: 1 }, exit: { height: 0, opacity: 0 }, transition: { type: 'tween', duration: 0.2 }, className: "overflow-hidden", children: _jsxs("ul", { className: "ml-5 space-y-1 border-l border-gray-300 pl-3", children: [_jsx("li", { children: _jsxs(NavLink, { to: "/dompet/dompet-santri", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(CreditCard, { className: "w-5 h-5" }), hasAccess('dompet.dompet-santri') && sidebarOpen && _jsx("span", { children: "Dompet Santri" })] }) }), _jsx("li", { children: _jsxs(NavLink, { to: "/dompet/rfid", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Users, { className: "w-5 h-5" }), hasAccess('dompet.rfid') && sidebarOpen && _jsx("span", { children: "RFID" })] }) }), _jsx("li", { children: _jsxs(NavLink, { to: "/dompet/history", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(FileText, { className: "w-5 h-5" }), hasAccess('dompet.history') && sidebarOpen && _jsx("span", { children: "History & Laporan" })] }) }), _jsx("li", { children: _jsxs(NavLink, { to: "/dompet/settings", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Settings, { className: "w-5 h-5" }), hasAccess('dompet.settings') && sidebarOpen && _jsx("span", { children: "Setting" })] }) }), _jsx("li", { children: _jsxs(NavLink, { to: "/dompet/withdrawals", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Receipt, { className: "w-5 h-5" }), hasAccess('dompet.withdrawals') && sidebarOpen && _jsx("span", { children: "Penarikan (ePOS)" })] }) })] }) })) })] }), _jsxs("div", { className: "space-y-1", children: [_jsxs("button", { type: "button", onClick: () => setAkademikOpen((v) => !v), className: `w-full flex items-center gap-3 rounded-md px-3 py-2 text-sm ${akademikActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Calendar, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Akademik" })] }), _jsx(AnimatePresence, { initial: false, children: akademikOpen && sidebarOpen && (_jsx(motion.div, { initial: { height: 0, opacity: 0 }, animate: { height: 'auto', opacity: 1 }, exit: { height: 0, opacity: 0 }, transition: { type: 'tween', duration: 0.2 }, className: "overflow-hidden", children: _jsx("ul", { className: "ml-5 space-y-1 border-l border-gray-300 pl-3", children: _jsx("li", { children: _jsxs(NavLink, { to: "/akademik/tahun-ajaran", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Calendar, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Tahun Ajaran" })] }) }) }) })) })] }), _jsxs("div", { className: "border-t border-gray-200 pt-2 space-y-1", children: [sidebarOpen && hasAccess('pengguna') && (_jsxs(NavLink, { to: "/pengguna", className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(UserCog, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: "Pengguna" })] })), bottomMenu.map((m) => {
                                    const Icon = m.icon;
                                    return (_jsxs(NavLink, { to: m.to, className: ({ isActive }) => `flex items-center gap-3 rounded-md px-3 py-2 text-sm ${isActive ? 'bg-white text-brand shadow-sm' : 'text-gray-700 hover:bg-white'}`, children: [_jsx(Icon, { className: "w-5 h-5" }), sidebarOpen && _jsx("span", { children: m.label })] }, m.to));
                                })] })] }) })] }));
}
